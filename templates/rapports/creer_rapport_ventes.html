{% extends 'base.html' %}
{% load static %}

{% block title %}Créer un rapport de ventes - DEVDRECO SOFT{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- En-tête -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-chart-line text-primary me-2"></i>
                        Créer un rapport de ventes
                    </h2>
                    <p class="text-muted mb-0">Générez un rapport détaillé de vos ventes</p>
                </div>
                <div>
                    <a href="{% url 'rapports:dashboard' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Retour
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-cog me-2"></i>Configuration du rapport
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nom" class="form-label">
                                        <i class="fas fa-tag me-1"></i>Nom du rapport
                                    </label>
                                    <input type="text" class="form-control" id="nom" name="nom" 
                                           placeholder="Ex: Rapport ventes Janvier 2024" required>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="type_rapport" class="form-label">
                                        <i class="fas fa-calendar me-1"></i>Type de rapport
                                    </label>
                                    <select class="form-select" id="type_rapport" name="type_rapport" required>
                                        <option value="">Sélectionner un type</option>
                                        <option value="journalier">Journalier</option>
                                        <option value="hebdomadaire">Hebdomadaire</option>
                                        <option value="mensuel" selected>Mensuel</option>
                                        <option value="annuel">Annuel</option>
                                        <option value="personnalise">Période personnalisée</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="date_debut" class="form-label">
                                        <i class="fas fa-calendar-alt me-1"></i>Date de début
                                    </label>
                                    <input type="date" class="form-control" id="date_debut" name="date_debut" required>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="date_fin" class="form-label">
                                        <i class="fas fa-calendar-alt me-1"></i>Date de fin
                                    </label>
                                    <input type="date" class="form-control" id="date_fin" name="date_fin" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="format_sortie" class="form-label">
                                        <i class="fas fa-file me-1"></i>Format de sortie
                                    </label>
                                    <select class="form-select" id="format_sortie" name="format_sortie" required>
                                        <option value="pdf" selected>PDF</option>
                                        <option value="excel">Excel (.xlsx)</option>
                                        <option value="csv">CSV</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <h6 class="mb-3">
                                    <i class="fas fa-filter me-2"></i>Options d'inclusion
                                </h6>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="inclure_devis" name="inclure_devis" checked>
                                    <label class="form-check-label" for="inclure_devis">
                                        <i class="fas fa-file-invoice me-1"></i>Inclure les devis
                                    </label>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="inclure_factures" name="inclure_factures" checked>
                                    <label class="form-check-label" for="inclure_factures">
                                        <i class="fas fa-receipt me-1"></i>Inclure les factures
                                    </label>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="inclure_commandes" name="inclure_commandes" checked>
                                    <label class="form-check-label" for="inclure_commandes">
                                        <i class="fas fa-shopping-cart me-1"></i>Inclure les commandes
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col-12">
                                <h6 class="mb-3">
                                    <i class="fas fa-chart-pie me-2"></i>Options de groupement
                                </h6>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="groupe_par_client" name="groupe_par_client">
                                    <label class="form-check-label" for="groupe_par_client">
                                        <i class="fas fa-users me-1"></i>Grouper par client
                                    </label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="groupe_par_article" name="groupe_par_article">
                                    <label class="form-check-label" for="groupe_par_article">
                                        <i class="fas fa-box me-1"></i>Grouper par article
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-end gap-2">
                                    <a href="{% url 'rapports:dashboard' %}" class="btn btn-secondary">
                                        <i class="fas fa-times me-1"></i>Annuler
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-chart-line me-1"></i>Générer le rapport
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Informations
                    </h5>
                </div>
                <div class="card-body">
                    <h6>Types de rapports disponibles :</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success me-2"></i><strong>Journalier :</strong> Rapport du jour</li>
                        <li><i class="fas fa-check text-success me-2"></i><strong>Hebdomadaire :</strong> Rapport de la semaine</li>
                        <li><i class="fas fa-check text-success me-2"></i><strong>Mensuel :</strong> Rapport du mois</li>
                        <li><i class="fas fa-check text-success me-2"></i><strong>Annuel :</strong> Rapport de l'année</li>
                        <li><i class="fas fa-check text-success me-2"></i><strong>Personnalisé :</strong> Période libre</li>
                    </ul>

                    <hr>

                    <h6>Formats de sortie :</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-file-pdf text-danger me-2"></i><strong>PDF :</strong> Pour impression et archivage</li>
                        <li><i class="fas fa-file-excel text-success me-2"></i><strong>Excel :</strong> Pour analyse et manipulation</li>
                        <li><i class="fas fa-file-csv text-info me-2"></i><strong>CSV :</strong> Pour import dans d'autres systèmes</li>
                    </ul>

                    <hr>

                    <div class="alert alert-info">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Astuce :</strong> Les rapports sont générés en arrière-plan. Vous recevrez une notification une fois le traitement terminé.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-remplir les dates selon le type de rapport
    const typeRapport = document.getElementById('type_rapport');
    const dateDebut = document.getElementById('date_debut');
    const dateFin = document.getElementById('date_fin');
    
    function updateDates() {
        const today = new Date();
        const type = typeRapport.value;
        
        if (type === 'journalier') {
            dateDebut.value = today.toISOString().split('T')[0];
            dateFin.value = today.toISOString().split('T')[0];
        } else if (type === 'hebdomadaire') {
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            dateDebut.value = startOfWeek.toISOString().split('T')[0];
            dateFin.value = endOfWeek.toISOString().split('T')[0];
        } else if (type === 'mensuel') {
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            dateDebut.value = startOfMonth.toISOString().split('T')[0];
            dateFin.value = endOfMonth.toISOString().split('T')[0];
        } else if (type === 'annuel') {
            const startOfYear = new Date(today.getFullYear(), 0, 1);
            const endOfYear = new Date(today.getFullYear(), 11, 31);
            
            dateDebut.value = startOfYear.toISOString().split('T')[0];
            dateFin.value = endOfYear.toISOString().split('T')[0];
        }
    }
    
    typeRapport.addEventListener('change', updateDates);
    
    // Initialiser avec le type mensuel
    updateDates();
});
</script>
{% endblock %}



